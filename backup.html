<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ambient Peripheral Noise</title>
  <style>
    :root { --bg: #0b0c10; --fg: #9fffb3; --dim: #3a5; --accent: #00d18f; --glow: rgba(0, 255, 136, .4); --panel: rgba(0,0,0,.6); }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body { margin:0; background: var(--bg); color: var(--fg); font: 400 12px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, "Cascadia Mono", "Liberation Mono", monospace; overflow:hidden; -webkit-font-smoothing: antialiased; text-rendering: optimizeSpeed; }

    #dock { position: fixed; right: 12px; bottom: 12px; width: min(40vw, 520px); height: min(40vh, 300px); background: var(--panel); border: 1px solid #1c1; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,.6), inset 0 0 18px var(--glow); padding: 10px 12px 8px; display:flex; flex-direction: column; backdrop-filter: blur(3px) saturate(1.2); z-index: 9999; }
    #dock.max { inset: 0 !important; width: 100vw !important; height: 100vh !important; left: 0 !important; top: 0 !important; right: 0 !important; bottom: 0 !important; border-radius: 0; padding: 14px 16px; }
    #title { font-weight: 600; letter-spacing:.06em; color: var(--accent); display:flex; align-items:center; gap:8px; user-select:none; cursor:move; margin-bottom:6px; }
    #title .dot { width:8px; height:8px; border-radius:50%; background: #16ff6b; box-shadow: 0 0 12px 2px #16ff6b }

    #terminal { flex:1; overflow:hidden; position: relative; }
    #lines { position:absolute; inset:0; overflow: hidden; }
    .line { white-space: pre; word-break: break-all; text-shadow: 0 0 8px var(--glow); line-height: 1.55; font-variant-ligatures: none; }
    .line.bar { text-shadow: none; font-family: Consolas, "Cascadia Mono", "Courier New", monospace; font-size: 95%; line-height: 1.55; }

    #footer { display:flex; flex-wrap: wrap; gap:10px; font-size: 10px; color:#9aa; opacity:.9; margin-top:6px; user-select:none; justify-content: space-between; align-items:center; }
    .group { display:flex; gap:6px; align-items:center }
    button { background:#111; border:1px solid #333; border-radius:6px; padding: 2px 8px; font-size: 10px; color:#bdf; cursor:pointer; }
    button:hover { background:#222; border-color:#555; }
    .badge { border:1px solid #3a3; border-radius: 999px; padding:2px 8px; color:#9fffb3; }

    .scanlines::after { content:""; position:absolute; inset:0; background-image: linear-gradient(rgba(255,255,255,.05) 1px, transparent 1px); background-size: 100% 3px; pointer-events:none; mix-blend-mode: overlay; opacity:.12; }
    .flicker { animation: flicker 6s infinite steps(60); }
    @keyframes flicker { 0%,100% { opacity: 1 } 50% { opacity: .98 } 60% { opacity: .92 } 70% { opacity: .99 } }
    .blink::after { content: "▋"; margin-left:2px; animation: blink 1s step-end infinite; }
    @keyframes blink { 50% { opacity: 0 } }
    </style>
</head>
<body>
  <div id="dock" class="scanlines flicker">
    <div id="title"><span class="dot"></span><span>crypto-log • idle</span></div>
    <div id="terminal">
      <div id="lines"></div>
    </div>
    
    <div id="footer">
      <div class="group">
        <button id="speedDown">-</button>
        <button id="speedUp">+</button>
        speed
      </div>
      <div class="group">
        <span class="badge">theme: <span id="themeName">console</span></span>
        <!--<label for="themeSelect" class="sr-only">Theme</label>
         <select id="themeSelect"></select> -->
      </div>
      <div class="group">
        <span class="badge">mode: <span id="modeName">crypto</span></span>
       <!--  <label for="modeSelect" class="sr-only">Mode</label>
       <select id="modeSelect"></select>-->
      </div>
      <div class="group">
        <span class="badge">bar: <span id="barName">dots</span></span>
       <!--  <label for="barSelect" class="sr-only">Progress Bar</label>
       <select id="barSelect"></select>-->
      </div>
      <div class="group">
        <button id="pauseBtn">Pause</button>
        <button id="clearBtn">Clear</button>
        <button id="dockBtn">Dock</button>
        <button id="fullBtn">Full</button>
        <button id="fullscreenBtn">Fullscreen</button>
      </div>
    </div>
  </div>
</div>

  <script>
  (() => {
    // --- Config ---
    const cfg = {
      minDelay: 120,
      maxDelay: 220,
      lineInterval: [180,520],
      maxLines: 160,
      theme: 'console',
      dock: 'br',
      intensity: 1,
      persona: 'crypto',
      barStyle: 'dots' // default now uses centered dot (·)
    };
    // Edge tends to render U+2591 (░) tall; pick a safer default there
    try {
      if (navigator.userAgent && navigator.userAgent.includes('Edg')) {
        cfg.barStyle = 'dots';
      }
    } catch (_) {}

    const themes = {
      console: { bg:'#0b0c10', fg:'#a9ffb6', accent:'#00d18f', glow:'rgba(0,255,136,.4)', border:'#1c1' },
      mainframe:  { bg:'#0a0700', fg:'#ffd18a', accent:'#ffae00', glow:'rgba(255,170,0,.35)', border:'#ffae00' },
      msdos:   { bg:'#1F1F1F', fg:'#C0C0C0', accent:'#FFFFFF', glow:'rgba(192,192,192,0.25)', border:'#808080' },
      clu:   { bg:'#001318', fg:'#9de7ff', accent:'#2ad1ff', glow:'rgba(42,209,255,.35)', border:'#154a57' },
      skynet:   { bg:'#0a0000', fg:'#ff4d4d', accent:'#ff0000', glow:'rgba(255,0,0,0.35)', border:'#660000' },
      deepthought:   { bg:'#0a0010', fg:'#e0b3ff', accent:'#aa33ff', glow:'rgba(170,51,255,0.35)', border:'#550088' }
    };

    const barStyles = {
      dots: { fill:'█', empty:'·' },
      shade:  { fill:'█', empty:'░' },
      dash:  { fill:'█', empty:'-' },
      space: { fill:'█', empty:' ' }
    };

    const dockPositions = {
      br: { right:'12px', left:'auto', bottom:'12px', top:'auto' },
      bl: { left:'12px', right:'auto', bottom:'12px', top:'auto' },
      tr: { right:'12px', left:'auto', top:'12px', bottom:'auto' },
      tl: { left:'12px', right:'auto', top:'12px', bottom:'auto' }
    };

    const dockEl = document.getElementById('dock');
    const titleEl = document.getElementById('title').querySelector('span:nth-child(2)');
    const linesEl = document.getElementById('lines');
    const fullBtn = document.getElementById('fullBtn');
    const modeName = document.getElementById('modeName');
    const barName = document.getElementById('barName');
    const themeName = document.getElementById('themeName');
    // Dropdown options
    const THEME_OPTIONS = ['console','mainframe','msdos','clu','skynet','deepthought'];
    const MODE_OPTIONS  = ['crypto','sysadmin'];
    const BAR_OPTIONS   = ['dots','shade','dash','space'];

    // Select elements
    const themeSelect = document.getElementById('themeSelect');
    const modeSelect  = document.getElementById('modeSelect');
    const barSelect   = document.getElementById('barSelect');

    function populateSelect(sel, items, current){
      if(!sel) return;
      sel.innerHTML = items.map(v => '<option value="' + v + '">' + v + '</option>').join('');
      sel.value = current;
    }

    function setTheme(name){
      cfg.theme = name;
      applyTheme(cfg.theme);
      if (themeName) themeName.textContent = name;
      if (themeSelect && themeSelect.value !== name) themeSelect.value = name;
    }
    function setMode(mode){ cfg.persona = mode; if (modeName) modeName.textContent = mode; titleEl.textContent = cfg.persona + '-log • stream'; if (modeSelect && modeSelect.value !== mode) modeSelect.value = mode; }
    function setBar(style){ cfg.barStyle = style; if (barName) barName.textContent = style; if (barSelect && barSelect.value !== style) barSelect.value = style; }

    // Populate selects on load
    populateSelect(themeSelect, THEME_OPTIONS, cfg.theme);
    populateSelect(modeSelect,  MODE_OPTIONS,  cfg.persona);
    populateSelect(barSelect,   BAR_OPTIONS,   cfg.barStyle);

    // Wire change handlers
    if (themeSelect) themeSelect.addEventListener('change', e => setTheme(e.target.value));
    if (modeSelect)  modeSelect.addEventListener('change',  e => setMode(e.target.value));
    if (barSelect)   barSelect.addEventListener('change',   e => setBar(e.target.value));


    function applyTheme(name){
      const t = themes[name] || themes.matrix;
      document.documentElement.style.setProperty('--bg', t.bg);
      document.documentElement.style.setProperty('--fg', t.fg);
      document.documentElement.style.setProperty('--accent', t.accent);
      document.documentElement.style.setProperty('--glow', t.glow);
      dockEl.style.borderColor = t.border;
    }
    function applyDock(pos){ Object.assign(dockEl.style, dockPositions[pos] || dockPositions.br); }
    applyTheme(cfg.theme); applyDock(cfg.dock);

    // Shared helpers
    const rBetween = (min,max)=> Math.random()*(max-min)+min;
    const rInt = (min,max)=> Math.floor(rBetween(min, max+1));
    const pick = (arr)=> arr[rInt(0, arr.length-1)];
    const randHex = (len)=> Array.from({length:len}, ()=> Math.floor(Math.random()*16).toString(16)).join('');
    const timeStamp = ()=> new Date().toTimeString().slice(0,8);

    // Crypto content
    const loremWords = ("lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat").split(' ');
    const cryptoCmds = ['handshake','derive-key','expand-key','encrypt','decrypt','rotate-keys','seal','unseal','attest','generate-iv','hkdf','pbkdf2','scrypt','argon2','sha256','sha512','blake3','keccak','sign','verify'];
    const cryptoPrefixes = ['INFO','WARN','TRACE','DEBUG'];
    const cryptoPathbits = ['srv','vault','node','shard','cluster','core','io','bus','net','gpu0','gpu1','cpu0','mem','cache','disk0'];
    let progress = 0;
    function lorem(n){ return Array.from({length:n}, ()=> pick(loremWords)).join(' '); }

    function makeProgBar(pct){
      const width = 20;
      const { fill, empty } = barStyles[cfg.barStyle] || barStyles.dots;
      const filled = Math.round(pct/100*width);
      return fill.repeat(filled) + empty.repeat(width-filled);
    }

    function makeLineCrypto(){
      const choice = Math.random();
      if(choice < 0.16){
        progress += rInt(1,7); if(progress > 100) progress = 0;
        const bar = makeProgBar(progress);
        return `[${timeStamp()}] ${pick(cryptoPrefixes)}   PROG ${String(progress).padStart(3,' ')}%  [${bar}]`;
      } else if(choice < 0.32) {
        const bytes = Array.from({length: rInt(8,16)}, () => randHex(2)).join(' ');
        return `[${timeStamp()}] HEX   ${randHex(8)}: ${bytes}`;
      } else if(choice < 0.48) {
        const cmd = pick(cryptoCmds);
        const node = pick(cryptoPathbits)+'/'+pick(cryptoPathbits)+'/'+rInt(0,9);
        return `[${timeStamp()}] ${pick(cryptoPrefixes)}   ${cmd} --src ${node} --key 0x${randHex(16)} --iv 0x${randHex(8)} ... ok`;
      } else if(choice < 0.64) {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
        let s=''; const len=rInt(22,54); for(let i=0;i<len;i++) s += chars[rInt(0,chars.length-1)];
        return `[${timeStamp()}] BLOB  ${s}==`;
      } else if(choice < 0.80) {
        return `[${timeStamp()}] NOTE  ${lorem(rInt(6,14))}.`;
      } else {
        return `[${timeStamp()}] STAT  latency=${rInt(2,80)}ms  shards=${rInt(1,6)}  temp=${(rBetween(35,78)).toFixed(1)}°C  nonce=0x${randHex(6)}`;
      }
    }

    // Sysadmin content
    const hosts = ['web-01','web-02','api-01','db-01','db-02','cache-01','router-01','backup-01'];
    const services = ['nginx','postgres','redis','sshd','docker','systemd','cron','vault','consul','kubelet'];
    const units = ['Started','Stopped','Restarted','Reloaded','Failed','Listening'];
    const levels = ['INFO','NOTICE','WARN','ERR','CRIT','DEBUG'];
    const ips = ()=> `${rInt(10,223)}.${rInt(0,255)}.${rInt(0,255)}.${rInt(1,254)}`;
    const ports = [22,80,443,5432,6379,9000,3000,8080,9200];
    const httpCodes = [200,201,204,301,302,400,401,403,404,409,418,429,500,502,503];

    function makeLineSysadmin(){
      const style = Math.random();
      if(style < 0.18){
        return `[${timeStamp()}] ${pick(levels)} ${pick(hosts)} systemd: ${pick(services)} ${pick(units)} (${rInt(1,120)}ms)`;
      } else if(style < 0.36){
        return `[${timeStamp()}] ${pick(levels)} ${pick(hosts)} sshd[${rInt(1000,9999)}]: ${Math.random()<0.5?'Accepted':'Failed'} password for user ${['root','deploy','ci','postgres'][rInt(0,3)]} from ${ips()} port ${pick(ports)}`;
      } else if(style < 0.54){
        return `[${timeStamp()}] ${pick(levels)} ${pick(hosts)} nginx: ${ips()} - - "GET /${['health','api/v1/status','_next/','static/'][rInt(0,3)]}" ${pick(httpCodes)} ${rInt(128, 4096)} "-" "curl/${rInt(7,8)}.${rInt(0,99)}"`;
      } else if(style < 0.72){
        return `[${timeStamp()}] ${pick(levels)} ${pick(hosts)} postgres[${rInt(100,999)}]: connection ${rInt(1,200)} authorized: user=${['app','readonly','replica'][rInt(0,2)]} db=${['main','analytics','replica'][rInt(0,2)]} duration=${rInt(1,180)}ms`;
      } else if(style < 0.90){
        return `[${timeStamp()}] ${pick(levels)} ${pick(hosts)} docker: container ${randHex(12)} ${['started','stopped','restarted','pulled image'][rInt(0,3)]} ${['ok','exit 0','exit 137','exit 1'][rInt(0,3)]}`;
      } else {
        return `[${timeStamp()}] ${pick(levels)} ${pick(hosts)} kernel: cpu${rInt(0,7)}: temp ${(rBetween(40,84)).toFixed(1)}°C  fan ${rInt(900,2200)}rpm  mem ${rInt(35,96)}%`;
      }
    }

    function makeLine(){ return cfg.persona === 'sysadmin' ? makeLineSysadmin() : makeLineCrypto(); }

    function addLine(s, typing=false){
      const line = document.createElement('div');
      line.className = 'line';
      const isBar = s.includes(' PROG ') && s.includes('[') && s.includes('%');
      if(isBar) line.classList.add('bar');
      if(typing){
        let i=0;
        const step = () => {
          if(paused) return;
          line.textContent = s.slice(0, i);
          line.classList.toggle('blink', true);
          i++;
          if(i <= s.length){
            linesEl.appendChild(line);
            trim();
            setTimeout(step, rBetween(cfg.minDelay, cfg.maxDelay) / cfg.intensity);
          } else {
            line.classList.remove('blink');
          }
        };
        step();
      } else {
        line.textContent = s;
        linesEl.appendChild(line);
        trim();
      }
    }

    function trim(){
      const max = cfg.maxLines;
      while(linesEl.children.length > max){ linesEl.removeChild(linesEl.firstChild); }
      linesEl.scrollTop = linesEl.scrollHeight;
    }

    let paused = false;
    function scheduleNext(){ setTimeout(tick, rBetween(cfg.lineInterval[0], cfg.lineInterval[1]) / cfg.intensity); }
    function tick(){
      if(paused){ scheduleNext(); return; }
      const typing = Math.random() < 0.22;
      addLine(makeLine(), typing);
      titleEl.textContent = `${cfg.persona}-log • ${typing ? 'typing' : 'stream'}`;
      scheduleNext();
    }

    for(let i=0;i<8;i++) addLine(makeLine(), false);
    scheduleNext();
    // Start in full-window
    dockEl.classList.add('max');
    fullBtn.textContent = 'Mini';

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if(k === '+'){ cfg.intensity *= 1.2 }
      if(k === '-'){ cfg.intensity /= 1.2 }
      if(k === 'p'){ togglePause(); }
      if(k === 'c'){ clearLines(); }
      if(k === '1'){ setTheme('console'); }
      if(k === '2'){ setTheme('mainframe'); }
      if(k === '3'){ setTheme('msdos'); }
      if(k === '4'){ setTheme('clu'); }
      if(k === '5'){ setTheme('skynet'); }
      if(k === '6'){ setTheme('deepthought'); }
      if(k === 'd'){ cycleDock(); }
      if(k === 'f'){ toggleMax(); }
      if(k === 'm'){ cycleMode(); }
      if(k === 'b'){ cycleBar(); }
      if(k === 'escape' && maximized){ toggleMax(); }
    });

    // Button actions
    document.getElementById('speedUp').onclick = ()=> cfg.intensity *= 1.2;
    document.getElementById('speedDown').onclick = ()=> cfg.intensity /= 1.2;
    // removed theme buttons: now using select + setTheme()
    document.getElementById('pauseBtn').onclick = ()=> togglePause();
    document.getElementById('clearBtn').onclick = ()=> clearLines();
    document.getElementById('dockBtn').onclick = ()=> cycleDock();
    // removed mode buttons: now using select + setMode()
    // removed bar buttons: now using select + setBar()
    fullBtn.onclick = ()=> toggleMax();

    function togglePause(){ paused = !paused; titleEl.textContent = `${cfg.persona}-log • ${paused ? 'paused' : 'stream'}`; }
    function clearLines(){ linesEl.innerHTML=''; }
    function cycleDock(){ cfg.dock = (cfg.dock==='br')?'bl':(cfg.dock==='bl')?'tl':(cfg.dock==='tl')?'tr':'br'; applyDock(cfg.dock); }

    function setMode(mode){ cfg.persona = mode; modeName.textContent = mode; titleEl.textContent = `${cfg.persona}` }
    function cycleMode(){ setMode(cfg.persona === 'crypto' ? 'sysadmin' : 'crypto'); }

    function setBar(style){ cfg.barStyle = style; barName.textContent = style; }
    function cycleBar(){ const order=['dots','shade','dash','space']; setBar(order[(order.indexOf(cfg.barStyle)+1)%order.length]); }

    // Full-window toggle
    let maximized = true;
    function toggleMax(){
      maximized = !maximized;
      dockEl.classList.toggle('max', maximized);
      titleEl.textContent = `${cfg.persona}-log • ${maximized ? 'FULL' : 'stream'}`;
      fullBtn.textContent = maximized ? 'Dock' : 'Full';
      if(!maximized) applyDock(cfg.dock);
    }

    // Drag move
    (() => {
      const header = document.getElementById('title');
      let startX=0, startY=0, startLeft=0, startTop=0, dragging=false;
      function onMouseDown(ev){
        if(maximized) return; // disable drag while full-window
        dragging = true;
        startX = ev.clientX; startY = ev.clientY;
        const rect = dockEl.getBoundingClientRect();
        startLeft = rect.left; startTop = rect.top;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      }
      function onMouseMove(ev){
        if(!dragging) return;
        const dx = ev.clientX - startX, dy = ev.clientY - startY;
        const left = Math.max(8, Math.min(window.innerWidth - dockEl.offsetWidth - 8, startLeft + dx));
        const top  = Math.max(8, Math.min(window.innerHeight - dockEl.offsetHeight - 8, startTop + dy));
        Object.assign(dockEl.style, { left:left+'px', top:top+'px', right:'auto', bottom:'auto' });
      }
      function onMouseUp(){ dragging = false; document.removeEventListener('mousemove', onMouseMove); document.removeEventListener('mouseup', onMouseUp); }
      header.addEventListener('mousedown', onMouseDown);
    })();


    // Fullscreen controls
    (function(){
      var fullscreenBtn = document.getElementById('fullscreenBtn');
      if(!fullscreenBtn) return;
      function refreshFS(){
        fullscreenBtn.textContent = document.fullscreenElement ? 'Exit Fullscreen' : 'Fullscreen';
      }
      document.addEventListener('fullscreenchange', refreshFS);
      fullscreenBtn.addEventListener('click', function(){
        if(document.fullscreenElement){ document.exitFullscreen(); }
        else { try { document.documentElement.requestFullscreen(); } catch(e){} }
      });
      refreshFS();
    })();

    // Reduced motion
    if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){
      dockEl.classList.remove('flicker');
      cfg.intensity = 0.8;
      cfg.lineInterval = [260, 620];
    }
  })();
  </script>
</body>
</html>
